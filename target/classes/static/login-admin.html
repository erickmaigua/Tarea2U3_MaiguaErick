<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Administrador - Zapatería</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="/css/style-login-admin.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <i data-lucide="shield" class="icon-lg"></i>
                Panel Administrativo
            </h1>
            <p>Acceso Restringido</p>
        </div>
        
        <div class="content">
            <div id="alertContainer"></div>
            
            <!-- LOGIN FORM -->
            <div id="loginForm" class="form-container active">
                <form onsubmit="login(event)">
                    <div class="form-group">
                        <label>
                            <i data-lucide="user"></i>
                            Usuario
                        </label>
                        <input type="text" id="loginUsername" placeholder="Usuario admin o empleado" required>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <i data-lucide="lock"></i>
                            Contraseña
                        </label>
                        <input type="password" id="loginPassword" placeholder="Contraseña segura" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i data-lucide="shield-check"></i>
                        Acceder al Sistema
                    </button>
                </form>
                
                <div class="footer-links">
                    <a href="login-cliente.html">
                        <i data-lucide="shopping-bag"></i>
                        Volver a la tienda
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:8080/api';
        
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            
            const icon = type === 'success' ? 'check-circle' : type === 'warning' ? 'alert-triangle' : 'alert-circle';
            alertDiv.innerHTML = `
                <i data-lucide="${icon}"></i>
                <span>${message}</span>
            `;
            
            const container = document.getElementById('alertContainer');
            container.innerHTML = '';
            container.appendChild(alertDiv);
            
            lucide.createIcons();
            
            setTimeout(() => alertDiv.remove(), 5000);
        }
        
        async function login(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!username.trim() || !password.trim()) {
                showAlert('Por favor complete todos los campos', 'warning');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/usuarios/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username, password})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const rol = data.usuario.rol;
                    
                    if (rol === 'ADMINISTRADOR' || rol === 'EMPLEADO' || rol === 'DESPACHO') {
                        sessionStorage.setItem('currentUser', JSON.stringify(data.usuario));
                        showAlert('Acceso concedido. Bienvenido ' + data.usuario.nombre, 'success');
                        
                        setTimeout(() => {
                            window.location.href = 'admin.html';
                        }, 1500);
                    } else {
                        showAlert('Acceso denegado. Solo para administradores y empleados', 'error');
                    }
                } else {
                    showAlert(data.mensaje || 'Credenciales incorrectas', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('Error al conectar con el servidor', 'error');
            }
        }
        
        // Inicializar iconos
        lucide.createIcons();
    </script>
</body>
</html>