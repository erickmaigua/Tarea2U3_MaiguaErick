<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Cliente - Zapatería</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="/css/style-login-cliente.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>
                <i data-lucide="shopping-bag" class="icon-lg"></i>
                Zapatería Online
            </h1>
            <p>Bienvenido Cliente</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('login')">
                <i data-lucide="log-in"></i> Iniciar Sesión
            </button>
            <button class="tab" onclick="switchTab('register')">
                <i data-lucide="user-plus"></i> Registrarse
            </button>
        </div>

        <div class="content">
            <div id="alertContainer"></div>

            <!-- LOGIN FORM -->
            <div id="loginForm" class="form-container active">
                <form onsubmit="login(event)">
                    <div class="form-group">
                        <label>
                            <i data-lucide="user"></i>
                            Usuario
                        </label>
                        <input type="text" id="loginUsername" placeholder="Tu nombre de usuario" required>
                    </div>

                    <div class="form-group">
                        <label>
                            <i data-lucide="lock"></i>
                            Contraseña
                        </label>
                        <input type="password" id="loginPassword" placeholder="Tu contraseña" required>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i data-lucide="log-in"></i>
                        Ingresar a la Tienda
                    </button>
                </form>

                <div class="footer-links">
                    <a href="login-admin.html">
                        <i data-lucide="shield"></i>
                        ¿Eres administrador? Ingresa aquí
                    </a>
                </div>
            </div>

            <!-- REGISTER FORM -->
            <div id="registerForm" class="form-container">
                <form onsubmit="register(event)">
                    <div class="form-group">
                        <label>
                            <i data-lucide="user"></i>
                            Nombre
                        </label>
                        <input type="text" id="regNombre" placeholder="Juan" required>
                    </div>

                    <div class="form-group">
                        <label>
                            <i data-lucide="user"></i>
                            Apellido
                        </label>
                        <input type="text" id="regApellido" placeholder="Pérez" required>
                    </div>

                    <div class="form-group">
                        <label>
                            <i data-lucide="mail"></i>
                            Email
                        </label>
                        <input type="email" id="regEmail" placeholder="juan@email.com" required>
                    </div>

                    <div class="form-group">
                        <label>
                            <i data-lucide="phone"></i>
                            Teléfono
                        </label>
                        <input type="tel" id="regTelefono" placeholder="0999999999" required>
                    </div>

                    <div class="form-group">
                        <label>
                            <i data-lucide="map-pin"></i>
                            Dirección
                        </label>
                        <input type="text" id="regDireccion" placeholder="Tu dirección completa" required>
                    </div>

                    <div class="form-group">
                        <label>
                            <i data-lucide="user-circle"></i>
                            Usuario
                        </label>
                        <input type="text" id="regUsername" placeholder="juanperez" required>
                    </div>

                    <div class="form-group">
                        <label>
                            <i data-lucide="lock"></i>
                            Contraseña
                        </label>
                        <input type="password" id="regPassword" placeholder="Mínimo 6 caracteres" required
                            minlength="6">
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i data-lucide="user-plus"></i>
                        Crear mi Cuenta
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8080/api';

        function switchTab(tab) {
            // Actualizar tabs
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.closest('.tab').classList.add('active');

            // Actualizar formularios
            document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
            document.getElementById(tab + 'Form').classList.add('active');

            // Limpiar alertas
            document.getElementById('alertContainer').innerHTML = '';

            // Reinicializar iconos
            lucide.createIcons();
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;

            const icon = type === 'success' ? 'check-circle' : 'alert-circle';
            alertDiv.innerHTML = `
                <i data-lucide="${icon}"></i>
                <span>${message}</span>
            `;

            const container = document.getElementById('alertContainer');
            container.innerHTML = '';
            container.appendChild(alertDiv);

            lucide.createIcons();

            setTimeout(() => alertDiv.remove(), 5000);
        }

        async function login(e) {
            e.preventDefault();

            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_URL}/usuarios/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.success && data.usuario.rol === 'CLIENTE') {
                    sessionStorage.setItem('currentUser', JSON.stringify(data.usuario));
                    showAlert('¡Bienvenido ' + data.usuario.nombre + '!', 'success');

                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1500);
                } else if (data.success && data.usuario.rol !== 'CLIENTE') {
                    showAlert('Esta zona es solo para clientes', 'error');
                } else {
                    showAlert(data.mensaje, 'error');
                }
            } catch (error) {
                showAlert('Error al conectar con el servidor', 'error');
            }
        }

        async function register(e) {
            e.preventDefault();

            const usuario = {
                nombre: document.getElementById('regNombre').value,
                apellido: document.getElementById('regApellido').value,
                email: document.getElementById('regEmail').value,
                telefono: document.getElementById('regTelefono').value,
                direccion: document.getElementById('regDireccion').value,
                username: document.getElementById('regUsername').value,
                password: document.getElementById('regPassword').value
            };

            try {
                const response = await fetch(`${API_URL}/usuarios/registro-cliente`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(usuario)
                });

                const data = await response.json();

                if (data.success) {
                    showAlert('¡Cuenta creada! Ahora puedes iniciar sesión', 'success');
                    e.target.reset();

                    setTimeout(() => {
                        document.querySelector('.tab').click();
                    }, 2000);
                } else {
                    showAlert(data.mensaje, 'error');
                }
            } catch (error) {
                showAlert('Error al conectar con el servidor', 'error');
            }
        }

        // Inicializar iconos
        lucide.createIcons();
    </script>
</body>

</html>