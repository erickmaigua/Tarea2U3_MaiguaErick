<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tienda - Zapater√≠a Online</title>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="/css/styles-index.css">
</head>

<body>
  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="nav-brand">
        <i data-lucide="shopping-bag"></i>
        CalzadoOnline
      </a>

      <div class="nav-menu">
        <div class="user-info">
          <span class="user-name">
            <i data-lucide="user"></i>
            <span id="userName">Cliente</span>
          </span>

          <button class="cart-btn" type="button" onclick="toggleCart()">
            <i data-lucide="shopping-cart"></i>
            <span id="cartCount" class="cart-badge">0</span>
          </button>

          <button class="cart-btn" type="button" onclick="abrirMisPedidos()" style="margin-left:10px;">
            <i data-lucide="truck"></i>
            <span style="margin-left:6px;">Mis Pedidos</span>
          </button>

          <button class="logout-btn" type="button" onclick="logout()">
            <i data-lucide="log-out"></i>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <div class="container">
    <!-- HERO -->
    <div class="hero">
      <h1>üëü Encuentra tu Estilo Perfecto</h1>
      <p>Explora nuestra colecci√≥n de calzado de alta calidad</p>
    </div>

    <!-- FILTERS -->
    <div class="filters">
      <div class="filters-grid">
        <div class="filter-group">
          <label>üîç Buscar</label>
          <input type="text" id="searchInput" placeholder="Buscar productos..." onkeyup="filtrarProductos()">
        </div>

        <div class="filter-group">
          <label>üìÇ Categor√≠a</label>
          <select id="filterCategoria" onchange="filtrarProductos()">
            <option value="">Todas</option>
            <option value="deportivo">Deportivo</option>
            <option value="casual">Casual</option>
            <option value="formal">Formal</option>
            <option value="running">Running</option>
            <option value="urbano">Urbano</option>
          </select>
        </div>

        <div class="filter-group">
          <label>üè∑Ô∏è Marca</label>
          <select id="filterMarca" onchange="filtrarProductos()">
            <option value="">Todas</option>
          </select>
        </div>

        <div class="filter-group">
          <label>üí≤ Precio M√°ximo</label>
          <input type="number" id="filterPrecio" placeholder="Precio m√°ximo" min="0" onkeyup="filtrarProductos()">
        </div>
      </div>
    </div>

    <!-- PRODUCTS -->
    <div class="products-header">
      <h2>Cat√°logo de Productos</h2>
      <span class="products-count" id="productsCount">0 productos</span>
    </div>

    <div id="alertContainer"></div>
    <div class="products-grid" id="productsGrid"></div>
  </div>

  <!-- CART MODAL -->
  <div class="modal" id="cartModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>
          <i data-lucide="shopping-cart"></i>
          Mi Carrito
        </h2>
        <button class="close-modal" type="button" onclick="toggleCart()">
          <i data-lucide="x" style="width: 28px; height: 28px;"></i>
        </button>
      </div>

      <div class="modal-body">
        <div id="cartItems"></div>

        <div class="cart-summary" id="cartSummary" style="display:none;">
          <div class="summary-row">
            <span>Subtotal:</span>
            <span id="subtotal">$0.00</span>
          </div>
          <div class="summary-row">
            <span>Env√≠o:</span>
            <span>$5.00</span>
          </div>
          <div class="summary-total">
            <span>Total:</span>
            <span id="total">$0.00</span>
          </div>

          <!-- PAGO -->
          <div id="pagoBox" style="margin-top:12px;">
            <div class="summary-row" style="flex-direction:column; align-items:flex-start; gap:6px;">
              <label style="font-weight:600;">M√©todo de Pago</label>
              <select id="metodoPago" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb;">
                <option value="">Seleccione un m√©todo</option>
                <option value="EFECTIVO">Efectivo</option>
                <option value="TARJETA_CREDITO">Tarjeta de Cr√©dito</option>
                <option value="TARJETA_DEBITO">Tarjeta de D√©bito</option>
              </select>
            </div>

            <div class="summary-row" id="tarjetaBox"
              style="display:none; flex-direction:column; align-items:flex-start; gap:6px;">
              <label style="font-weight:600;">√öltimos 4 d√≠gitos de la tarjeta</label>
              <input type="text" id="tarjetaUltimos4" maxlength="4" placeholder="1234"
                style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb;">
            </div>
          </div>

          <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
            <button class="cart-btn" type="button" onclick="abrirMisPedidos()">
              <i data-lucide="truck"></i>
              <span style="margin-left:6px;">Mis Pedidos</span>
            </button>

            <button class="checkout-btn" type="button" onclick="realizarPedido()">
              <i data-lucide="check-circle"></i>
              Realizar Pedido
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MIS PEDIDOS MODAL -->
  <div class="modal" id="pedidosModal" style="display:none;">
    <div class="modal-content" style="max-width:900px;">
      <div class="modal-header">
        <h2>
          <i data-lucide="truck"></i>
          Mis Pedidos
        </h2>
        <button class="close-modal" type="button" onclick="togglePedidos(false)">
          <i data-lucide="x" style="width: 28px; height: 28px;"></i>
        </button>
      </div>

      <div class="modal-body">
        <div id="misPedidosContainer"></div>
      </div>
    </div>
  </div>

  <!-- DETALLE PEDIDO MODAL -->
  <div class="modal" id="detallePedidoModal" style="display:none;">
    <div class="modal-content" style="max-width:900px;">
      <div class="modal-header">
        <h2>
          <i data-lucide="receipt"></i>
          Detalle del Pedido
        </h2>
        <button class="close-modal" type="button" onclick="toggleDetalle(false)">
          <i data-lucide="x" style="width: 28px; height: 28px;"></i>
        </button>
      </div>
      <div class="modal-body">
        <div id="detallePedidoContainer"></div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:8080/api'; // ajusta si tu puerto cambia

    let productos = [];
    let carrito = [];
    let currentUser = null;

    // ====== MODALES ======
    function toggleCart() {
      document.getElementById('cartModal').classList.toggle('active');
    }

    function togglePedidos(open) {
      const modal = document.getElementById('pedidosModal');
      if (open) {
        modal.style.display = 'flex';
        modal.classList.add('active');
      } else {
        modal.classList.remove('active');
        modal.style.display = 'none';
      }
    }

    function toggleDetalle(open) {
      const modal = document.getElementById('detallePedidoModal');
      if (open) {
        modal.style.display = 'flex';
        modal.classList.add('active');
      } else {
        modal.classList.remove('active');
        modal.style.display = 'none';
      }
    }

    // ====== M√âTODO DE PAGO ======
    document.addEventListener("DOMContentLoaded", () => {
      const metodoPago = document.getElementById('metodoPago');
      const tarjetaBox = document.getElementById('tarjetaBox');
      const tarjetaUltimos4 = document.getElementById('tarjetaUltimos4');

      metodoPago.addEventListener('change', function () {
        if (this.value === 'TARJETA_CREDITO' || this.value === 'TARJETA_DEBITO') {
          tarjetaBox.style.display = 'flex';
        } else {
          tarjetaBox.style.display = 'none';
          tarjetaUltimos4.value = '';
        }
      });
    });

    // ====== SESI√ìN ======
    function checkSession() {
      const user = sessionStorage.getItem('currentUser');
      if (!user) {
        window.location.href = 'login-cliente.html';
        return;
      }
      currentUser = JSON.parse(user);
      document.getElementById('userName').textContent = currentUser.nombre;
      cargarProductos();
    }

    // ====== PRODUCTOS ======
    async function cargarProductos() {
      try {
        const response = await fetch(`${API_URL}/productos`);
        if (!response.ok) throw new Error("HTTP " + response.status);
        productos = await response.json();

        const selectMarca = document.getElementById('filterMarca');
        selectMarca.innerHTML = `<option value="">Todas</option>`;
        const marcas = [...new Set(productos.map(p => p.marca))];
        marcas.forEach(marca => {
          const option = document.createElement('option');
          option.value = marca;
          option.textContent = marca;
          selectMarca.appendChild(option);
        });

        mostrarProductos(productos);
      } catch (error) {
        console.error(error);
        showAlert('Error al cargar productos', 'error');
        mostrarProductos([]);
      }
    }

    function mostrarProductos(items) {
      const grid = document.getElementById('productsGrid');
      grid.innerHTML = '';
      document.getElementById('productsCount').textContent = `${items.length} productos`;

      if (items.length === 0) {
        grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 40px; color: #6b7280;">No se encontraron productos</p>';
        return;
      }

      items.forEach(prod => {
        const stockClass = prod.stock > 20 ? 'stock-high' : prod.stock > 10 ? 'stock-medium' : 'stock-low';
        const stockText = prod.stock > 20 ? 'Stock Alto' : prod.stock > 10 ? 'Stock Medio' : 'Stock Bajo';

        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          <div class="product-image">
            ${prod.imagen ? `<img src="${prod.imagen}" style="width:100%; height:100%; object-fit:cover;">` : `<i data-lucide="package"></i>`}
            <span class="product-badge">${prod.codigo}</span>
            <span class="stock-badge ${stockClass}">${stockText}</span>
          </div>
          <div class="product-info">
            <div class="product-category">${prod.categoria}</div>
            <div class="product-name">${prod.nombre}</div>
            <div class="product-brand">${prod.marca}</div>
            <div class="product-details">
              <div class="product-detail"><i data-lucide="ruler"></i> Talla ${prod.talla}</div>
              <div class="product-detail"><i data-lucide="palette"></i> ${prod.color}</div>
            </div>
            <div class="product-footer">
              <div class="product-price">$${Number(prod.precio).toFixed(2)}</div>
              <button class="add-to-cart" onclick="agregarAlCarrito('${prod.id}')" ${prod.stock === 0 ? 'disabled' : ''}>
                <i data-lucide="shopping-cart"></i>
                ${prod.stock === 0 ? 'Agotado' : 'Agregar'}
              </button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });

      lucide.createIcons();
    }

    function filtrarProductos() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const categoria = document.getElementById('filterCategoria').value;
      const marca = document.getElementById('filterMarca').value;
      const precioInput = document.getElementById('filterPrecio').value;
      const precioMax = precioInput === '' ? Infinity : parseFloat(precioInput);

      const filtrados = productos.filter(p => {
        const matchSearch = (p.nombre || '').toLowerCase().includes(search) ||
          (p.marca || '').toLowerCase().includes(search) ||
          (p.descripcion || '').toLowerCase().includes(search);
        const matchCategoria = !categoria || p.categoria === categoria;
        const matchMarca = !marca || p.marca === marca;
        const matchPrecio = Number(p.precio) <= precioMax;
        return matchSearch && matchCategoria && matchMarca && matchPrecio;
      });

      mostrarProductos(filtrados);
    }

    // ====== CARRITO ======
    function agregarAlCarrito(productoId) {
      const producto = productos.find(p => p.id === productoId);
      if (!producto || producto.stock === 0) return;

      const itemExistente = carrito.find(item => item.id === productoId);

      if (itemExistente) {
        if (itemExistente.cantidad < producto.stock) itemExistente.cantidad++;
        else return showAlert('Stock m√°ximo alcanzado', 'error');
      } else {
        carrito.push({
          id: producto.id,
          nombre: producto.nombre,
          precio: Number(producto.precio),
          cantidad: 1,
          stockDisponible: producto.stock
        });
      }

      actualizarCarrito();
      showAlert('Producto agregado al carrito', 'success');
    }

    function actualizarCarrito() {
      const count = carrito.reduce((sum, item) => sum + item.cantidad, 0);
      document.getElementById('cartCount').textContent = count;

      const container = document.getElementById('cartItems');
      const cartSummary = document.getElementById('cartSummary');

      if (carrito.length === 0) {
        container.innerHTML = `
          <div class="empty-cart">
            <i data-lucide="shopping-cart"></i>
            <p>Tu carrito est√° vac√≠o</p>
          </div>
        `;
        cartSummary.style.display = 'none';

        document.getElementById('metodoPago').value = '';
        document.getElementById('tarjetaUltimos4').value = '';
        document.getElementById('tarjetaBox').style.display = 'none';

        lucide.createIcons();
        return;
      }

      container.innerHTML = '';
      carrito.forEach(item => {
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <div class="cart-item-icon"><i data-lucide="package"></i></div>
          <div class="cart-item-info">
            <div class="cart-item-name">${item.nombre}</div>
            <div class="cart-item-details">$${item.precio.toFixed(2)} c/u</div>
          </div>
          <div class="cart-item-actions">
            <div class="qty-control">
              <button class="qty-btn" onclick="cambiarCantidad('${item.id}', -1)"><i data-lucide="minus"></i></button>
              <span>${item.cantidad}</span>
              <button class="qty-btn" onclick="cambiarCantidad('${item.id}', 1)"><i data-lucide="plus"></i></button>
            </div>
            <button class="remove-btn" onclick="eliminarDelCarrito('${item.id}')"><i data-lucide="trash-2"></i></button>
          </div>
        `;
        container.appendChild(div);
      });

      const subtotal = carrito.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
      const total = subtotal + 5;

      document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
      document.getElementById('total').textContent = `$${total.toFixed(2)}`;
      cartSummary.style.display = 'block';

      lucide.createIcons();
    }

    function cambiarCantidad(productoId, delta) {
      const item = carrito.find(i => i.id === productoId);
      if (!item) return;

      const nuevaCantidad = item.cantidad + delta;
      if (nuevaCantidad < 1) return eliminarDelCarrito(productoId);
      if (nuevaCantidad > item.stockDisponible) return showAlert('Stock m√°ximo alcanzado', 'error');

      item.cantidad = nuevaCantidad;
      actualizarCarrito();
    }

    function eliminarDelCarrito(productoId) {
      carrito = carrito.filter(item => item.id !== productoId);
      actualizarCarrito();
      showAlert('Producto eliminado del carrito', 'success');
    }

    // ====== PEDIDO ======
    async function realizarPedido() {
      if (carrito.length === 0) {
        showAlert('El carrito est√° vac√≠o', 'error');
        return;
      }

      const metodoPago = document.getElementById('metodoPago').value;
      const tarjetaUltimos4 = document.getElementById('tarjetaUltimos4').value;

      if (!metodoPago) return showAlert('Seleccione un m√©todo de pago', 'error');

      if ((metodoPago === 'TARJETA_CREDITO' || metodoPago === 'TARJETA_DEBITO') && tarjetaUltimos4.length !== 4) {
        return showAlert('Ingrese los √∫ltimos 4 d√≠gitos de la tarjeta', 'error');
      }

      const items = carrito.map(item => ({
        productoId: item.id,
        nombreProducto: item.nombre,
        cantidad: item.cantidad,
        precio: item.precio
      }));

      const pedido = {
        clienteId: currentUser.id,
        clienteNombre: `${currentUser.nombre} ${currentUser.apellido}`,
        items,
        estado: 'PENDIENTE',
        metodoPago,
        estadoPago: metodoPago === 'EFECTIVO' ? 'PENDIENTE' : 'PAGADO',
        tarjetaUltimos4: metodoPago === 'EFECTIVO' ? null : tarjetaUltimos4
      };

      try {
        const response = await fetch(`${API_URL}/pedidos`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(pedido)
        });

        const data = await response.json();

        if (data.success) {
          showAlert(`¬°Pedido realizado! N√∫mero: ${data.pedido.numeroPedido}`, 'success');
          carrito = [];
          actualizarCarrito();
          toggleCart();
          setTimeout(() => cargarProductos(), 1500);
        } else {
          showAlert('Error al procesar el pedido', 'error');
        }
      } catch (error) {
        console.error(error);
        showAlert('Error al conectar con el servidor', 'error');
      }
    }

    // ====== MIS PEDIDOS (estado + detalle + factura) ======
    async function abrirMisPedidos() {
      togglePedidos(true);
      await cargarMisPedidos();
      lucide.createIcons();
    }

    async function cargarMisPedidos() {
      try {
        const container = document.getElementById('misPedidosContainer');
        container.innerHTML = 'Cargando...';

        const res = await fetch(`${API_URL}/pedidos/mis-pedidos/${currentUser.id}`);
        const pedidos = await res.json();

        if (!pedidos || pedidos.length === 0) {
          container.innerHTML = `<p style="padding:20px;color:#6b7280;">No tienes pedidos todav√≠a.</p>`;
          return;
        }

        container.innerHTML = pedidos.map(p => `
          <div style="border:1px solid #e5e7eb; border-radius:10px; padding:14px; margin-bottom:12px;">
            <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
              <div>
                <strong>${p.numeroPedido}</strong>
                <div style="color:#6b7280;font-size:13px;">${p.fecha ? new Date(p.fecha).toLocaleString('es-ES') : '-'}</div>
              </div>
              <div>
                <span style="padding:6px 10px; border-radius:999px; background:#f3f4f6;">
                  Estado: <b>${p.estado}</b>
                </span>
              </div>
            </div>

            <hr style="margin:12px 0;border:none;border-top:1px solid #eee;"/>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
              <div>
                <div><b>Pago:</b> ${p.metodoPago || '-'}</div>
                <div><b>Estado Pago:</b> ${p.estadoPago || '-'}</div>
                ${p.tarjetaUltimos4 ? `<div><b>Tarjeta:</b> **** ${p.tarjetaUltimos4}</div>` : ``}
              </div>
              <div>
                <div><b>Seguimiento:</b> ${p.codigoSeguimiento || '-'}</div>
                <div><b>Estado Despacho:</b> ${p.estadoDespacho || '-'}</div>
                <div><b>Ubicaci√≥n:</b> ${p.ubicacionActual || '-'}</div>
              </div>
            </div>

            <div style="margin-top:12px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
              <div><b>Total:</b> $${Number((p.totalFinal ?? p.total ?? 0)).toFixed(2)}</div>

              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button class="checkout-btn" style="padding:10px 14px;" onclick="verDetallePedidoCliente('${p.id}')">
                  <i data-lucide="eye"></i> Ver detalle
                </button>

                <button class="checkout-btn" style="padding:10px 14px;" onclick="descargarFacturaCliente('${p.id}')">
                  <i data-lucide="file-text"></i> Factura
                </button>
              </div>
            </div>
          </div>
        `).join('');

      } catch (err) {
        console.error(err);
        document.getElementById('misPedidosContainer').innerHTML =
          `<p style="padding:20px;color:#ef4444;">Error cargando pedidos</p>`;
      }
    }

    async function verDetallePedidoCliente(pedidoId) {
      try {
        const container = document.getElementById('detallePedidoContainer');
        container.innerHTML = 'Cargando...';
        toggleDetalle(true);

        const res = await fetch(`${API_URL}/pedidos/${pedidoId}`);
        const pedido = await res.json();

        const itemsHTML = (pedido.items || []).map(it => `
          <tr>
            <td style="padding:8px;border-bottom:1px solid #eee;">${it.nombreProducto || '-'}</td>
            <td style="padding:8px;border-bottom:1px solid #eee;">${it.cantidad}</td>
            <td style="padding:8px;border-bottom:1px solid #eee;">$${Number(it.precio || 0).toFixed(2)}</td>
            <td style="padding:8px;border-bottom:1px solid #eee;">$${Number((it.precio || 0) * (it.cantidad || 0)).toFixed(2)}</td>
          </tr>
        `).join('');

        container.innerHTML = `
          <div style="border:1px solid #e5e7eb; border-radius:10px; padding:14px;">
            <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
              <div>
                <div><b>N¬∞ Pedido:</b> ${pedido.numeroPedido || '-'}</div>
                <div><b>Fecha:</b> ${pedido.fecha ? new Date(pedido.fecha).toLocaleString('es-ES') : '-'}</div>
              </div>
              <div>
                <span style="padding:6px 10px; border-radius:999px; background:#f3f4f6;">
                  Estado: <b>${pedido.estado || '-'}</b>
                </span>
              </div>
            </div>

            <hr style="margin:12px 0;border:none;border-top:1px solid #eee;"/>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
              <div>
                <div><b>M√©todo Pago:</b> ${pedido.metodoPago || '-'}</div>
                <div><b>Estado Pago:</b> ${pedido.estadoPago || '-'}</div>
                ${pedido.tarjetaUltimos4 ? `<div><b>Tarjeta:</b> **** ${pedido.tarjetaUltimos4}</div>` : ``}
              </div>
              <div>
                <div><b>Seguimiento:</b> ${pedido.codigoSeguimiento || '-'}</div>
                <div><b>Estado Despacho:</b> ${pedido.estadoDespacho || '-'}</div>
                <div><b>Ubicaci√≥n:</b> ${pedido.ubicacionActual || '-'}</div>
              </div>
            </div>

            <h3 style="margin-top:14px;">Items</h3>
            <div style="overflow:auto;">
              <table style="width:100%; border-collapse:collapse;">
                <thead>
                  <tr>
                    <th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">Producto</th>
                    <th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">Cant.</th>
                    <th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">Precio</th>
                    <th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">Subtotal</th>
                  </tr>
                </thead>
                <tbody>
                  ${itemsHTML || `<tr><td colspan="4" style="padding:10px;color:#6b7280;">Sin items</td></tr>`}
                </tbody>
              </table>
            </div>

            <div style="margin-top:12px; display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px;">
              <div><b>Total:</b> $${Number((pedido.totalFinal ?? pedido.total ?? 0)).toFixed(2)}</div>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button class="checkout-btn" style="padding:10px 14px;" onclick="descargarFacturaCliente('${pedidoId}')">
                  <i data-lucide="file-text"></i> Descargar Factura
                </button>
              </div>
            </div>
          </div>
        `;

        lucide.createIcons();
      } catch (e) {
        console.error(e);
        showAlert('No se pudo cargar el detalle', 'error');
      }
    }

    async function descargarFacturaCliente(pedidoId) {
      try {
        const response = await fetch(`${API_URL}/facturas/pedido/${pedidoId}`);
        if (!response.ok) {
          showAlert('No se pudo generar/descargar la factura', 'error');
          return;
        }
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `factura-pedido-${pedidoId}.pdf`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);
      } catch (e) {
        console.error(e);
        showAlert('Error descargando factura', 'error');
      }
    }

    // ====== ALERTAS ======
    function showAlert(message, type) {
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type}`;
      const icon = type === 'success' ? 'check-circle' : 'alert-circle';
      alertDiv.innerHTML = `<i data-lucide="${icon}"></i><span>${message}</span>`;
      const container = document.getElementById('alertContainer');
      container.innerHTML = '';
      container.appendChild(alertDiv);
      lucide.createIcons();
      setTimeout(() => alertDiv.remove(), 4000);
    }

    // ====== LOGOUT ======
    function logout() {
      if (confirm('¬øCerrar sesi√≥n?')) {
        sessionStorage.clear();
        window.location.href = 'login-cliente.html';
      }
    }

    // cerrar modales clic afuera
    window.onclick = function (event) {
      const cartModal = document.getElementById('cartModal');
      const pedidosModal = document.getElementById('pedidosModal');
      const detalleModal = document.getElementById('detallePedidoModal');

      if (event.target === cartModal) toggleCart();
      if (event.target === pedidosModal) togglePedidos(false);
      if (event.target === detalleModal) toggleDetalle(false);
    };

    // INIT
    checkSession();
    lucide.createIcons();
  </script>
</body>

</html>
